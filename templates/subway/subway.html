{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">ğŸš‡ ì‹¤ì‹œê°„ ì§€í•˜ì²  ì—´ì°¨ í˜„í™©</h1>

    <form class="mb-3" onsubmit="event.preventDefault(); fetchData();">
        <label for="lineSelect" class="form-label">í˜¸ì„  ì„ íƒ</label>
        <select id="lineSelect" class="form-select w-auto d-inline">
            <option value="1í˜¸ì„ ">1í˜¸ì„ </option>
            <option value="2í˜¸ì„ " selected>2í˜¸ì„ </option>
            <option value="3í˜¸ì„ ">3í˜¸ì„ </option>
            <option value="4í˜¸ì„ ">4í˜¸ì„ </option>
            <option value="5í˜¸ì„ ">5í˜¸ì„ </option>
            <option value="6í˜¸ì„ ">6í˜¸ì„ </option>
            <option value="7í˜¸ì„ ">7í˜¸ì„ </option>
            <option value="8í˜¸ì„ ">8í˜¸ì„ </option>
            <option value="9í˜¸ì„ ">9í˜¸ì„ </option>
            <option value="ìˆ˜ì¸ë¶„ë‹¹ì„ ">ìˆ˜ì¸ë¶„ë‹¹ì„ </option>
            <option value="ì‹ ë¶„ë‹¹ì„ ">ì‹ ë¶„ë‹¹ì„ </option>
        </select>

        <button type="submit" class="btn btn-primary ms-2">ì¡°íšŒí•˜ê¸°</button>
    </form>

    <div class="table-responsive">
        <table class="table table-bordered table-hover text-nowrap" id="train-table">
            <thead class="table-dark">
                <tr>
                    <th>ì—´ì°¨ë²ˆí˜¸</th>
                    <th>ì§€í•˜ì² ID</th>
                    <th>í˜¸ì„ ëª…</th>
                    <th>í˜„ì¬ì—­ID</th>
                    <th>í˜„ì¬ì—­ëª…</th>
                    <th>ìµœì¢…ìˆ˜ì‹ ë‚ ì§œ</th>
                    <th>ìµœì¢…ìˆ˜ì‹ ì‹œê°</th>
                    <th>ìƒ/í•˜í–‰</th>
                    <th>ì¢…ì°©ì—­ID</th>
                    <th>ì¢…ì°©ì—­ëª…</th>
                    <th>ì—´ì°¨ìƒíƒœ</th>
                    <th>ê¸‰í–‰ì—¬ë¶€</th>
                    <th>ë§‰ì°¨ì—¬ë¶€</th>
                </tr>
            </thead>
            <tbody id="train-table-body">
                <!-- JSë¡œ ì±„ì›Œì§ -->
            </tbody>
        </table>
    </div>
{% endblock %}

{% block script %}
<script>
    function fetchData() {
        const lineId = document.getElementById('lineSelect').value;

        fetch(`/subway/position?line_id=${lineId}`)
            .then(response => response.json())
            .then(data => {
                const list = data.realtimePositionList;
                const tbody = document.getElementById('train-table-body');
                tbody.innerHTML = "";

                list.forEach(train => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${train.trainNo}</td>
                        <td>${train.subwayId}</td>
                        <td>${train.subwayNm}</td>
                        <td>${train.statnId}</td>
                        <td>${train.statnNm}</td>
                        <td>${train.lastRecptnDt}</td>
                        <td>${train.recptnDt}</td>
                        <td>${getUpDownText(train.updnLine)}</td>
                        <td>${train.statnTid}</td>
                        <td>${train.statnTnm}</td>
                        <td>${getStatusText(train.trainSttus)}</td>
                        <td>${getExpressText(train.directAt)}</td>
                        <td>${getLastText(train.lstcarAt)}</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(error => {
                const tbody = document.getElementById('train-table-body');
                tbody.innerHTML = `<tr><td colspan="13">âŒ ì˜¤ë¥˜: ${error}</td></tr>`;
            });
    }

    function getStatusText(code) {
        switch (code) {
            case "0": return "ì§„ì…";
            case "1": return "ë„ì°©";
            case "2": return "ì¶œë°œ";
            case "3": return "ì „ì—­ì¶œë°œ";
            default: return "ì•Œ ìˆ˜ ì—†ìŒ";
        }
    }

    function getUpDownText(code) {
        return code === "0" ? "ìƒí–‰" : code === "1" ? "í•˜í–‰" : "ë¯¸í™•ì¸";
    }

    function getExpressText(code) {
        switch (code) {
            case "0": return "ì¼ë°˜";
            case "1": return "ê¸‰í–‰";
            case "7": return "íŠ¹ê¸‰";
            default: return "ë¯¸í™•ì¸";
        }
    }

    function getLastText(code) {
        return code === "1" ? "ë§‰ì°¨" : "ì•„ë‹˜";
    }
</script>
{% endblock %}
